# 기능 사양서 v0.1 – 하루 자동 일기 앱
---

## 1. 기능: 음성 자동 녹음 (Voice Recorder)
---

### 목적
사용자가 별도 조작 없이 하루 일과 중 음성이 자동으로 기록되도록 한다.

### 동작 조건
- 앱 실행 시 백그라운드에서 녹음 활성화
- 무음 구간 감지 시 자동으로 구간 분리
- 저장은 로컬 우선 (보안 고려)

### 주요 설정 항목
| 옵션 | 설명 | 기본값 |
|------|------|--------|
| 녹음 주기 | 시간 단위 녹음 | 10분 |
| 무음 감지 임계값 | dB 기준 정적 시간 | 3초 |

### 예외 처리
- 마이크 권한 미부여 시 알림 및 비활성화
- 저장 용량 부족 시 녹음 일시 중단 + 알림

---

## 2. 기능: STT 변환 (Speech to Text)
---

### 목적
녹음된 음성을 텍스트로 변환하여 요약 및 감정 분석에 활용

### 입력
- 로컬 저장된 `.wav` 파일
- 예: `/recordings/2025-07-29_0930.wav`

### 처리 흐름
1. Whisper API 또는 로컬 모델로 텍스트 변환
2. 타임스탬프 포함 JSON 반환

### 출력 예시
```json
{
  "text": "오늘 회의에서는...",
  "segments": [
    {"start": "00:00:00", "end": "00:01:20", "text": "회의 시작 전..."}
  ]
}
```

### 예외 처리
- 음질 저하 또는 에러 발생 시 빈 텍스트 반환
- Whisper API 응답 실패 시 로컬로 대체

---

## 3. 기능: 요약 초안 생성 (Diary Summary Generation)
---

### 목적
STT로 생성된 텍스트를 Gemini 기반 요약으로 정리해 일기 초안 제공

### 입력
- 해당 날짜의 STT 전체 텍스트

### 처리 방식
- Gemini API 호출 (prompt-engineered)
- 사용자 맞춤형 요약 스타일 (설정 예정)

### 출력 예시
```json
{
  "summary": "오늘은 오전 회의와 점심 약속이 있었습니다.",
  "key_events": ["회의", "점심", "친구 연락"]
}
```

### 예외 처리
- 입력 누락 시 요약 미생성
- 응답 지연 시 로딩 스피너 표시

---

## 4. 기능: 감정 분석 (Emotion Analysis)
---

### 목적
하루의 텍스트 흐름에서 감정 상태를 분석하여 시각화

### 입력
- STT 텍스트 또는 요약문 전체

### 처리
- KoBERT 또는 HuggingFace 감정 분류 모델 사용
- 구간 단위 또는 하루 전체 분석

### 출력 예시
```json
{
  "overall_emotion": "neutral",
  "timeline": [
    {"time": "09:00", "emotion": "negative"},
    {"time": "12:00", "emotion": "positive"}
  ]
}
```

---

## 5. 기능: 일기 저장 및 불러오기
---

### 목적
AI 초안 + 사용자 수정본을 저장하고, 재조회 가능하도록 한다.

### 저장 구조
- `/diary/{user_id}/{YYYY-MM-DD ddd}.json`

### 필드 구조 예시
```json
{
  "date": "2025-07-29 화",
  "ai_summary": "...",
  "user_edit": "...",
  "emotions": [],
  "segments": []
}
```

### API 예시
- `GET /diary?date=2025-07-29 화`
- `POST /diary`
  payload: `{ summary, edit, segments }`

### 예외 처리
- 저장 실패 시 로컬에 캐시 후 재시도
- 데이터 변조 방지용 체크섬 고려
